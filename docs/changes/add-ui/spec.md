# FastAPI Web界面功能详细设计

## 目的
设计一个基于FastAPI的Web用户界面，提供图形化操作界面来替代现有的命令行界面，使用户可以通过网页浏览工作目录、选择处理文件、启动处理任务并查看处理结果。

## 需求

### 需求：Web应用框架
系统需要基于FastAPI框架构建，提供稳定的Web服务。

#### 场景：应用初始化
- 当用户首次访问Web应用时
- 系统将初始化FastAPI应用实例
- 应用将加载必要的配置和静态资源
- 应用将准备接收HTTP请求

### 需求：用户界面
系统需要提供直观的用户界面，支持工作目录浏览和任务管理。

#### 场景：主页显示
- 当用户访问根路径"/"时
- 系统将显示主页，包含以下组件：
  - 工作目录设置输入框
  - 工作目录文件树浏览区域
  - 已选择文件列表
  - "开始处理"按钮

#### 场景：任务管理页面
- 当用户访问"/tasks"路径时
- 系统将显示任务管理页面，包含：
  - 当前运行任务列表
  - 历史任务列表
  - 任务状态（待处理、处理中、已完成、已失败）
  - 任务开始时间和完成时间
  - 结果文件下载链接

#### 场景：结果展示页面
- 当用户访问特定任务结果时
- 系统将显示处理结果详情
  - 原始文件信息
  - 提取的数据预览
  - 处理日志
  - 结果文件下载选项

### 需求：工作目录浏览功能
系统需要提供本地工作目录的文件树浏览功能。

#### 场景：工作目录浏览
- 当用户设置工作目录后
- 系统将显示该目录下的所有子目录和文件
- 系统将支持目录树展开/折叠操作
- 系统将支持文件选择操作
- 系统将显示文件类型图标和基本信息

#### 场景：文件选择
- 当用户在文件树中选择文件时
- 系统将验证文件类型（.eml, .msg, .xlsx, .xls）
- 系统将将选定的文件添加到处理列表
- 系统将在UI上显示已选择的文件

### 需求：任务管理
系统需要提供任务创建、监控和管理功能。

#### 场景：任务创建
- 当用户点击"开始处理"按钮时
- 系统将基于当前设置和选择的文件创建处理任务
- 系统将分配唯一任务ID
- 系统将启动后台处理进程
- 系统将更新任务状态为"处理中"

#### 场景：任务状态监控
- 当用户启动任务时
- 系统将通过Streaming Response方式建立流式连接
- 系统将通过流式响应持续推送处理进度百分比
- 系统将通过流式响应持续推送实时处理日志
- 系统将通过流式响应更新任务状态（处理中、已完成、失败）
- 客户端将实时接收并更新UI显示

#### 场景：任务取消
- 当用户请求取消任务时
- 系统将尝试安全地中止当前处理进程
- 系统将更新任务状态为"已取消"
- 系统将清理相关临时文件

### 需求：与现有处理流程集成
系统需要保持与CLI模式相同的处理能力。

#### 场景：处理流程集成
- 当启动Web界面处理任务时
- 系统将调用现有的Pipeline、Extractor、Source和Destination组件
- 系统将使用与CLI模式相同的处理逻辑
- 系统将确保输出结果的一致性

### 需求：结果管理
系统需要妥善管理处理结果文件。

#### 场景：结果文件生成
- 当处理任务完成时
- 系统将在destination目录生成结果文件
- 系统将记录任务完成状态和元数据
- 系统将在任务管理页面显示完成状态

#### 场景：结果文件下载
- 当用户请求下载结果文件时
- 系统将验证用户权限
- 系统将提供安全的文件下载链接
- 系统将记录下载日志

### 需求：错误处理
系统需要提供完善的错误处理和用户反馈。

#### 场景：目录浏览错误处理
- 当工作目录访问失败时
- 系统将显示具体的错误信息
- 系统将记录错误日志

#### 场景：处理错误处理
- 当处理任务失败时
- 系统将显示错误信息和失败原因
- 系统将保存处理日志供用户查看

### 需求：安全和性能
系统需要确保基本的安全性和良好的性能。

#### 场景：目录安全
- 当访问工作目录时
- 系统将确保路径安全，防止路径遍历攻击
- 系统将限制访问范围到指定工作目录及其子目录

#### 场景：并发处理
- 当多个用户或任务同时运行时
- 系统将确保任务之间相互隔离
- 系统将合理分配系统资源
- 系统将避免资源竞争导致的错误